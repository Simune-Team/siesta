
%
% This TeX file includes the default environments for creating fdf blocks
% in the documentation of SIESTA.
%
% These utility functions have been implemented by:
%  Nick R. Papior, 2016 (nickpapior <at> gmail.com)
%

% Create a new output file for the short-manual.
% This file will contain all the short descriptions of
% the fdf-keys.

% create the correct fdf mode (for the fdf-environment)
\let\fdf@mode\leavevmode

% Declare fdf-colors
\definecolor{fdf-list}  {cmyk}{0.10,0.95,0.65,0.45}
\definecolor{fdf-option}{cmyk}{0.00,0.95,0.90,0.25}

% Declare new font
\DeclareTextFontCommand{\fontfdf}{\bfseries\hyphenchar\font=45\relax}
\let\fdffont\fontfdf


% Shorthand command for printing the fdf-key
% correctly, AND adding it to the index.
\NewDocumentCommand\fdf{ s m }
{%
    \fontfdf{\StrSubstitute[0]{#2}{!}{.}}%
    \IfBooleanF{#1}{%
        % Create index
        \sindex[sfdf]{#2}%
    }%
}


% Define the skip of a new fdf key
\newcommand\fdfentrybody{\parskip2pt}

\NewDocumentCommand\fdfabstract{ m }{\textlangle#1\textrangle}

\def\fdfentryline@None{None}
% Create the entry for the fdf-key
%
% #1: the name of the fdf-key
% #2: (optional) the type of the input value (string, true/false, physical quantity)
% #3: <> the default value of the fdf-key
\NewDocumentCommand\fdfentryline{ m o D<>{None}}
{ %
    \itemsep=0pt%
    \parskip=0pt%
    \bgroup%
    \raggedright\item%
    % Create fdf-label (with indexing)
    \strut{\bgroup\color{fdf-list}\fdf{#1}\egroup%
        % Separate the keyword from the options
        \hskip 1em plus 1ex minus 1ex
        %\space\space\space%
        \bgroup%
        \expandafter\let\siesta@active@bar\siesta@bar
        \def\tmp@None{#3}%
        \ifx\tmp@None\fdfentryline@None%
          \let\tmp@None\fdfabstract%
        \else%
          \let\tmp@None\relax%
        \fi%
        \strut{\color{fdf-option}\tmp@None{\fdf*{#3}}}%
        \egroup %
    }
    \IfValueT{#2}%
    {%
        \hfill\strut{\textit{(#2)}}%
    } %
    \par%
    \egroup%
    % Create fdf label
    \fdfentrybody%
}


% Create new fdf input
% This finalizes the call with \fdfenttryline
% which does the actual parsing of the arguments.
% This environment only sets up the enviroment
% to typeset things in.
\NewDocumentEnvironment{fdfentry}{ }
{   %
    % Create correct box-setups
    \bgroup
    \list{%
    }{ %
        % Define list
        \topsep=4pt
        \partopsep=0pt
        \leftmargin=2em\itemindent-\leftmargin %
        \listparindent=0pt
        %\def\makelabel##1{\hss##1} %
    }%
    % Create entry line of the argument
    \fdfentryline %
}
{%
    \endlist%
    \egroup
}


% Create new fdf input
% This finalizes the call with \fdfenttryline
% which does the actual parsing of the arguments.
% This environment only sets up the enviroment
% to typeset things in.
\NewDocumentEnvironment{fdfoptions}{ }
{   %
    \begingroup
    \def\option[##1]{%
        \item[\strut{\color{fdf-list}\fontfdf{##1}}] %
    }
    \list{}
    {%
        \labelwidth=1em
        \leftmargin=1em
        \parsep=2pt
        \listparindent=0pt
    }%
}
{%
    \endlist%
    \endgroup
}


% Simple environment which extends 
%   \begin{verbatim}
% 
%   \end{verbatim}
% It is simply intended as placeholder to easily change
% the future behaviour of the environment.
\DefineVerbatimEnvironment{fdfexample}{Verbatim}{xleftmargin=2em,fontsize=\small}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../siesta"
%%% End:
